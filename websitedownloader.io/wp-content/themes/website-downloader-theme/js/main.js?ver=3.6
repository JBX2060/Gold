(function($){'use strict';$(function(){var tries=0,baseMessageId,emailNotifyOpted=false,downloadInProgress=false,scrolled=0;var thanksMsg='Thanks, Your download is still in progress. <br />We will notify you once your website download zip is ready.';var notifyMsg='Downloading... <br /><br />Leave your e-mail address below so that we can notify you once your website download zip is ready.';$('.website-input-text').on('change input blur keyup paste copy cut delete mouseup',function(){var showSettings=false;var urlTarget=$(this).val();var urlParts=urlTarget.replace('https://','').replace('http://','').split('/');$('.website-input-text').val(urlTarget);if(urlParts.length>1){if(urlParts[1].length>0){showSettings=true;}}
if(urlTarget.length>1){$('.form-download-settings').show();if(scrolled===0&&shouldPageScroll===1){$('html, body').animate({scrollTop:'230px'},1000);scrolled=1;}}
if(isValidURL(urlTarget)){$('.form-website').addClass('has-success');}else{$('.form-website').removeClass('has-success');}
$('.website-to-download').text(urlParts[0]);if(showSettings){$('.form-download-settings .entire-extra').show();}else{$('.form-download-settings .entire-extra').hide();}});$('.email-input > a').on('click',function(e){e.preventDefault();emailNotifyOpted=true;$('.result').html(thanksMsg);var postData={action:"webdown_email_notify",wdnonce:$("#wdnonce").val(),inputEmail:$(".inputEmail").val(),messageId:baseMessageId};$('.email-input').remove();$.post('/wp-admin/admin-ajax.php',postData,function(msg){});});$('form.website-downloader').on('submit',function(e){e.preventDefault();$('.loadercss').show();analytics.track('Download Started',{category:'Download'});var btn=$(this).find('.btn');$('.result').html('Setting up your download...');btn.prop('disabled',true);$.post("/wp-admin/admin-ajax.php",{action:"webdown_fetch_website",wdnonce:$("#wdnonce").val(),inputEmail:$(".inputEmail").val(),website:$(".website-input-text").val(),skipVideos:1,skipEntire:$("input[name='skipEntire']:checked").val()},function(msg){$('.loadercss').hide();if(msg.success){analytics.track('Download Successful',{category:'Download'});$('.result').html('Downloading...');if(!isNaN(msg.message)){$('.result').html('Download has completed!');top.location.href=wdSettings.websitePreviewUrl+"?id="+ escape(msg.message);}else{baseMessageId=escape(msg.message);doPoll(escape(msg.message),btn);}}else{analytics.track('Download Failed',{category:'Download'});btn.prop('disabled',false);$('.result').text(msg.message);}});});function doPoll(messageId,buttonInstance){if(tries>99){tries=0;$('.download-estimates-time').show();}
tries++;if(!($('#wd-io-progress').is(':visible'))){$('#wd-io-progress').show();}
$('#wd-io-bar').css('width',(tries+ 1)+'%');$.post("/wp-admin/admin-ajax.php",{action:"webdown_fetch_website_status",wdnonce:$("#wdnonce").val(),messageId:messageId},function(msg){if(msg.success){$('.result').html('Download has completed!');top.location.href=wdSettings.websitePreviewUrl+"?id="+ escape(msg.message);setInterval(function(){$('#wd-io-bar').css('width',(tries+ 1)+'%');tries++;},10);downloadInProgress=false;}else{if(msg.message==='pending'){downloadInProgress=true;if(emailNotifyOpted){$('.result').html(thanksMsg);}else{$('.result').html(notifyMsg);$('.email-input').show();}
setTimeout(function(){doPoll(escape(messageId),buttonInstance);},3000);}else{downloadInProgress=false;buttonInstance.prop('disabled',false);$('#wd-io-progress').hide();$('.result').text(msg.message);}}});}
function isValidURL(url){if(url.substring(0,4)!='http://'&&url.substring(0,5)!='https://'){}
var urlPattern=/^(https?:\/\/)/;if(!urlPattern.test(url)){url='http://'+ url;}
try{var uri=new URI(url);var dotPresent=uri.host().indexOf('.');if(parseInt(dotPresent)>0){var dotSplit=uri.host().split('.');dotSplit=dotSplit[1].length;if(dotSplit>1){return true;}}
return false;}
catch(e){return false;}}
var exitModalOpts={backdrop:true,keyboard:true};glio.init(['top',function(){if(!downloadInProgress){$('.js-exit-popup').modal(exitModalOpts);}}]);$('#get-zip-btn').on('click',function(e){analytics.track('Get Zip Button Clicked',{category:'Preview'});});$('#get-zip-btn-2').on('click',function(e){$('.back-wd-asset-list-link').hide();analytics.track('Get Zip Button on Files List Clicked',{category:'Preview'});});$('.js-dashboard-link').on('click',function(e){analytics.track('Go Back Clicked',{category:'Preview'});});$('.zip-download-link').on('click',function(e){analytics.track('Download Link Clicked',{category:'WD Payments'});});$('.pay-button').on('click',function(e){analytics.track('Pay Button Clicked',{category:'WD Payments'});});$('.show-asset-list').on('click',function(e){analytics.track('Files List Shown',{category:'Preview'});$('#assets-area').modal('show');});$('#show-files-list-2').on('click',function(e){$('.back-wd-asset-list-link').show();$('#assets-area').modal('show');$('#payments-area').modal('hide');analytics.track('Files List Shown',{category:'Preview'});});$('.back-wd-asset-list-link').on('click',function(e){$(this).hide();$('#assets-area').modal('hide');$('#payments-area').modal('show');});$('#assets-area .close').on('click',function(e){$('.back-wd-asset-list-link').hide();});$('.timer').rooster('start',{seconds:1800,oncomplete:function(){}});});})(jQuery);